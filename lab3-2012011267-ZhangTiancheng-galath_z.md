#Lab3实验报告
计22，张天成，2012011267

<br>
##练习1

###设计实现过程

为给未被映射的地址映射上物理页，笔者以mm->pgdir、addr和1（若不存在则创建）为参数调用get_pte函数，查询获得或创建该地址对应的页表项，若该页表项为0，即尚未映射到物理地址，则以mm->pgdir、addr和之前获得的权限perm为参数调用pgdir_alloc_page函数，为该虚拟地址映射上物理页。

###思考题回答

1. 请描述页目录项（Page Directory Entry）和页表（Page Table Entry）中组成部分对ucore实现替换算法的潜在用处。

	页目录项和页表项中包含一些属性位，描述了对应的页目录项和页表项的只读性、权限和是否被访问等。在实现替换算法的过程中，权限和是否被访问都可能有参考价值，例如，权限高的页目录项和页表项可能是系统例程所需要的，对系统运行有重要作用，故不应该被替换出去；是否被访问则提供了有关访问情况的信息，有助于系统决定该页最近再次被利用的可能，从而实现更加高效的页替换算法。

2. 如果ucore的缺页服务例程在执行过程中访问内存，出现了页访问异常，请问硬件要做哪些事情？

	设置中断、保存现场、执行缺页服务例程并将对应的页面调入内存中、恢复现场、设置中断。
	（笔者不确定这样真的可行，如果出现这种情况，难道缺页服务例程本身不会受到破坏么？如果不可行的话，可能需要重新启动系统）
	
##练习2

###设计实现过程

在vmm.c文件的do_pgfault函数中，当确认物理页存在并需要通过替换进行载入后，笔者依次调用swap_in函数换入该页、调用page_insert函数实现映射、调用swap_map_swappable设置该页可替换。

在swap_fifo.c文件中，笔者在map_swappable函数中调用list_add函数将新页加入调入序列的末尾；在swap_out_victim函数中，用le2page宏获取序列的首个元素对应的页面，将其置换为ptr_page，并将序列的首个元素删去，从而完成了置换过程。

###思考题回答

足矣。在pra_list的每一项上附加一个访问标记和一个修改标记，然后在swap_out_victim函数中加入对这两个标记的检查和对访问标记的更新即可。具体而言：

* 需要被换出的页的特征：
	
	优先选择访问标记为未访问和修改标记为未修改的页面；若无，重新扫描pra_list，优先选择未访问但已修改的页面；若还无，重新扫描pra_list，优先选择已访问未修改的页面；若还无，选择第一个页面。
	
* 判断有这些特征的页的方法：

	在pra_list的每一项上附加上述两个标记（可以通过定义新的结构等方式实现）后，直接检查即可。
	
* 进行换入、换出操作的时间：

	与FIFO替换算法相同。